<h1>Messages</h1>

<nav class="message_nav">
  <% if @messaged_friends.present? %>
    <ul class="message_list">
      <% @messaged_friends.each do |friend| %>
        <li>
          <%= link_to message_path(friend.id) do %>
            <h3><%= friend.name %></h3>
            <% last_message = (Message.where(["sender_id = ? and recipient_id = ?", @current_user.id, friend.id]) + Message.where(["sender_id = ? and recipient_id = ?", friend.id, @current_user.id])).sort_by(&:created_at).last %>
            <% if last_message.created_at > Time.now.beginning_of_day %>
              <p><%= last_message.created_at.strftime("%l:%M %p") %></p>
            <% else %>
              <p><%= last_message.created_at.strftime("%e %b %Y") %></p>
            <% end %>
            <p><%= last_message.content %></p>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
  <div class="start_conversation">
    <button calss="message_friends">Message</button>
  </div>
</nav>

<div class="message_window">
</div>

<div class="message_friends_list">
</div>

<hr/>
